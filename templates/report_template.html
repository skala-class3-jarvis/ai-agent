<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            size: A4;
            margin: 18mm 18mm;
        }

        :root {
            --blue-dark: #0a1f44;
            --blue-primary: #0d66c2;
            --blue-light: #d8e5f7;
            --red-accent: #b22234;
            --grey-text: #5b6673;
            --grey-light: #d6dbe2;
            --grey-panel: #f4f6f9;
            --green: #2c8558;
        }

        body {
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
            font-size: 9pt;
            line-height: 1.4;
            color: var(--blue-dark);
            background: #ffffff;
        }

        .wrapper {
            border: 1px solid var(--grey-light);
            border-radius: 10px;
            padding: 20px 26px 26px;
            box-shadow: 0 8px 24px rgba(10, 31, 68, 0.08);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid var(--grey-light);
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--blue-primary), #4a9ff7);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .brand-label {
            text-transform: uppercase;
            letter-spacing: 1.4px;
            font-size: 7.5pt;
            color: var(--grey-text);
        }

        .title-block {
            text-align: right;
        }

        .title-block h1 {
            margin: 0;
            font-size: 15pt;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            color: var(--blue-primary);
        }

        .title-block span {
            display: block;
            margin-top: 4px;
            font-size: 7pt;
            color: var(--grey-text);
        }

        .company-overview {
            background: var(--grey-panel);
            border: 1px solid var(--grey-light);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 12px;
            font-size: 8.5pt;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .metric-card {
            background: var(--grey-panel);
            border: 1px solid var(--grey-light);
            border-radius: 8px;
            padding: 10px 12px;
            min-height: 60px;
        }

        .metric-label {
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--grey-text);
        }

        .metric-value {
            font-size: 12pt;
            font-weight: 600;
            margin-top: 4px;
        }

        .score-breakdown {
            margin: 14px 0 16px;
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 6px;
        }

        .score-segment {
            border: 1px solid var(--grey-light);
            border-radius: 8px;
            padding: 8px;
            background: #fff;
            text-align: center;
        }

        .score-segment .label {
            display: block;
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: var(--grey-text);
        }

        .score-segment .value {
            font-size: 11pt;
            font-weight: 600;
            margin-top: 4px;
        }

        .score-bar {
            margin-top: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--grey-light);
            position: relative;
            overflow: hidden;
        }

        .score-bar span {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--blue-primary), var(--green));
        }

        h2.section {
            margin: 12px 0 6px;
            font-size: 9.5pt;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        h2.section::before {
            content: "";
            width: 28px;
            height: 3px;
            border-radius: 999px;
            background: linear-gradient(90deg, var(--red-accent), var(--blue-primary));
        }

        .summary-text {
            background: var(--grey-panel);
            border: 1px solid var(--grey-light);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 10px;
        }

        .grid-two {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .mini-card {
            border: 1px solid var(--grey-light);
            border-radius: 8px;
            padding: 10px 12px;
            background: #ffffff;
        }

        ul.compact {
            margin: 6px 0 0;
            padding-left: 16px;
        }

        ul.compact li {
            margin-bottom: 3px;
        }

        table.slim {
            width: 100%;
            border-collapse: collapse;
            margin-top: 6px;
        }

        table.slim th,
        table.slim td {
            border: 1px solid var(--grey-light);
            padding: 6px 8px;
            font-size: 8pt;
            text-align: left;
        }

        table.slim th {
            background: rgba(13, 102, 194, 0.12);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .footnote {
            margin-top: 14px;
            border-top: 1px solid var(--grey-light);
            padding-top: 8px;
            font-size: 7pt;
            color: var(--grey-text);
        }
    </style>
</head>
<body>
{% set summary = data.get('llm_summary', {}) %}
{% set tech_summary = summary.get('technology', {}) %}
{% set market_summary = summary.get('market_competition', {}) %}
{% set risk_summary = summary.get('risk', {}) %}
{% set investment_summary = summary.get('investment', {}) %}
{% set metrics = data.get('headline_metrics', {}) %}
{% set scores = data.get('investment_scores', {}) %}
{% set score_breakdown = scores.get('scores', {}) %}
{% set risk = data.get('risk_assessment', {}) %}
{% set company = data.get('company_name', 'The company') %}
{% set domain = data.get('domain', '') %}
{% set tech_eval = data.get('tech_eval', {}) %}
{% set market_eval = data.get('market_eval', {}) %}
<div class="wrapper">
    <header>
        <div class="brand">
            <div class="badge">EL</div>
            <div class="brand-label">Edutech Lighthouse Briefing</div>
        </div>
        <div class="title-block">
            <h1>{{ company }}</h1>
            <span>Confidential · Investor Summary</span>
        </div>
    </header>

    <div class="company-overview">
        {% set location = market_eval.get('region') or data.get('location') or 'A global' %}
        {% set core = tech_eval.get('summary') or data.get('tech_summary', {}).get('summary') or market_eval.get('summary') %}
        {% if core %}
            {{ location }} edtech company focused on {{ domain if domain != '에듀테크' else 'education technology' }} solutions. {{ core[:180] }}{% if core|length > 180 %}…{% endif %}
        {% else %}
            {{ company }} is an edtech company delivering digital learning solutions.
        {% endif %}
    </div>

    <div class="metrics-row">
        <div class="metric-card">
            <div class="metric-label">Decision</div>
            <div class="metric-value" style="color: var(--blue-primary);">{{ metrics.get('decision', 'Under Review') }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Total Score</div>
            <div class="metric-value">{{ metrics.get('score', scores.get('total_score', 'N/A')) }}</div>
            <div class="metric-label" style="margin-top:4px;">Percentile {{ scores.get('percentile_rank', '—') }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Confidence</div>
            <div class="metric-value">{{ metrics.get('confidence', 'N/A') }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Overall Risk</div>
            <div class="metric-value" style="color: var(--red-accent);">{{ metrics.get('overall_risk', risk.get('overall_risk_score', 'N/A')) }}</div>
        </div>
    </div>

    {% if score_breakdown %}
    <div class="score-breakdown">
        {% for name, values in score_breakdown.items() %}
            {% set subtotal = values.get('subtotal', 0) %}
            {% set maximum = values.get('max', 1) %}
            {% set pct = (subtotal / maximum * 100) if maximum else 0 %}
            <div class="score-segment">
                <span class="label">{{ name.replace('_', ' ') | title }}</span>
                <span class="value">{{ subtotal }}/{{ maximum }}</span>
                <div class="score-bar">
                    <span style="width: {{ pct if pct < 100 else 100 }}%;"></span>
                </div>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <h2 class="section">Executive Summary</h2>
    <div class="summary-text">{{ summary.get('executive_summary', 'Summary pending.') }}</div>

    <div class="grid-two">
        <div class="mini-card">
            <strong>Technology</strong>
            <div style="margin-top:6px;">{{ tech_summary.get('paragraph', 'Awaiting input.') }}</div>
            {% if tech_summary.get('bullets') %}
            <ul class="compact">
                {% for item in tech_summary.get('bullets')[:3] %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        <div class="mini-card">
            <strong>Market & Competition</strong>
            <div style="margin-top:6px;">{{ market_summary.get('paragraph', 'Awaiting input.') }}</div>
            {% if market_summary.get('bullets') %}
            <ul class="compact">
                {% for item in market_summary.get('bullets')[:3] %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>

    <div class="grid-two" style="margin-top:10px;">
        <div class="mini-card">
            <strong>Risk Posture</strong>
            <div style="margin-top:6px;">{{ risk_summary.get('paragraph', 'Awaiting input.') }}</div>
            {% if risk_summary.get('bullets') %}
            <ul class="compact">
                {% for item in risk_summary.get('bullets')[:3] %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        <div class="mini-card">
            <strong>Investment Outlook</strong>
            <div style="margin-top:6px;">{{ investment_summary.get('paragraph', 'Awaiting input.') }}</div>
            {% if investment_summary.get('bullets') %}
            <ul class="compact">
                {% for item in investment_summary.get('bullets')[:3] %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>

    {% set competitors = data.get('competitor_list', []) %}
    {% if competitors %}
    <h2 class="section">Peer Snapshot</h2>
    <table class="slim">
        <thead>
            <tr>
                <th>Company</th>
                <th>Focus</th>
                <th>Overlap</th>
            </tr>
        </thead>
        <tbody>
            {% for rival in competitors[:2] %}
            <tr>
                <td>{{ rival.get('name', 'N/A') }}</td>
                <td>{{ rival.get('description', '')[:70] }}</td>
                <td>{{ rival.get('competitive_overlap', '—') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if risk %}
    <h2 class="section">Risk Metrics</h2>
    <table class="slim">
        <thead>
            <tr>
                <th>Risk Factor</th>
                <th>Level</th>
                <th>Likelihood</th>
                <th>Impact</th>
            </tr>
        </thead>
        <tbody>
            {% for key, payload in risk.items() %}
                {% if key != 'overall_risk_score' and payload is mapping %}
                <tr>
                    <td>{{ key.replace('_', ' ') | title }}</td>
                    <td>{{ payload.get('level', '—') }}</td>
                    <td>{{ payload.get('likelihood', '—') }}</td>
                    <td>{{ payload.get('impact', '—') }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <div class="footnote">
        Generated via LangGraph investment pipeline. Evaluation framework references ESSA Evidence Standards, HolonIQ Global Impact Intelligence, and recent EdTech investment trend benchmarks.
    </div>
</div>
</body>
</html>
